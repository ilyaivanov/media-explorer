{"version":3,"sources":["app/state/reducer.ts","app/Player.tsx","app/state/initialState.ts","app/Menu.tsx","app/state/actions.ts","app/state/selectors.ts","app/Triangle.tsx","app/Row.tsx","app/ItemsTree.tsx","app/SearchPanel.tsx","app/api.ts","app/ItemBeingDraggedAvatar.tsx","app/DropDestinationIndicator.tsx","app/App.tsx","serviceWorker.ts","index.tsx"],"names":["assignItem","state","itemId","mapper","items","findParentId","childId","Object","keys","find","parentKey","children","indexOf","reducer","action","type","i","isOpen","title","newName","nodeOverParentId","filter","child","withNewNode","node","id","parentId","concat","videoIdBeingPlayed","item","videoId","searchTerm","term","copy","forEach","map","options","isSearchVisible","itemBeingDraggedId","x","y","dropDestinationPlaceholder","newState","drop","undefined","dropPosition","itemBeingDragged","dropDescription","dropDestination","newChildren","splice","nodeUnderParentId","targetIndex","Player","className","opts","playerOpts","height","width","playerVars","autoplay","initialState","HOME","Menu","React","memo","dispatch","style","onClick","traverseOpenNodes","rootKey","mapItem","key","level","length","flat","Number","MAX_VALUE","Triangle","props","viewBox","points","Row","listenToDragEvents","useState","isBeingEdited","setIsBeingEdited","distanceTraveled","useRef","inputRef","useEffect","current","focus","isMouseDown","setIsMouseDown","onMouseMove","useCallback","e","clientX","clientY","console","log","Math","sqrt","movementY","movementX","onMouseUp","document","addEventListener","removeEventListener","paddingLeft","rect","currentTarget","getBoundingClientRect","targetLevel","actions","data-testid","onMouseDown","src","alt","value","ref","onBlur","onChange","ItemsTree","rootName","SearchPanel","search","debounce","fetch","then","response","json","data","name","searchItems","nodeId","trailing","ItemBeingDraggedAvatar","text","position","top","left","pointerEvents","display","alignItems","backgroundColor","borderRadius","fontSize","marginLeft","DropDestinationLine","App","useReducer","cn","random","Boolean","window","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.5219777d.chunk.js","sourcesContent":["import {\n  Item,\n  RootState,\n  RootAction,\n  NodesContainer,\n  DropDestinationPlaceholder,\n} from \"../types\";\n\nconst assignItem = (\n  state: RootState,\n  itemId: string,\n  mapper: (item: Item) => Partial<Item>\n) => ({\n  ...state,\n  items: {\n    ...state.items,\n    [itemId]: {\n      ...state.items[itemId],\n      ...mapper(state.items[itemId]),\n    },\n  },\n});\n\nconst findParentId = (items: NodesContainer, childId: string) =>\n  Object.keys(items).find(\n    (parentKey) => items[parentKey].children.indexOf(childId) > -1\n  ) as string;\n\nexport const reducer = (state: RootState, action: RootAction): RootState => {\n  if (action.type === \"TOGGLE_ITEM\") {\n    return assignItem(state, action.itemId, (i) => ({ isOpen: !i.isOpen }));\n  } else if (action.type === \"RENAME_ITEM\") {\n    return assignItem(state, action.itemId, () => ({ title: action.newName }));\n  } else if (action.type === \"REMOVE_ITEM\") {\n    const nodeOverParentId = findParentId(state.items, action.itemId);\n    return assignItem(state, nodeOverParentId, (i) => ({\n      children: i.children.filter((child) => child !== action.itemId),\n    }));\n  } else if (action.type === \"APPEND_NODE\") {\n    const withNewNode: RootState = {\n      ...state,\n      items: {\n        ...state.items,\n        [action.node.id]: action.node,\n      },\n    };\n    return assignItem(withNewNode, action.parentId, (i) => ({\n      children: i.children.concat([action.node.id]),\n    }));\n  } else if (action.type === \"PLAY_ITEM\") {\n    return {\n      ...state,\n      videoIdBeingPlayed: action.item.videoId,\n    };\n  } else if (action.type === \"SET_SEARCH_TERM\") {\n    return {\n      ...state,\n      searchTerm: action.term,\n    };\n  } else if (action.type === \"SET_NODE_CHILDREN\") {\n    //TODO: remove nodes without references\n    const copy = {\n      ...state,\n      items: {\n        ...state.items,\n      },\n    };\n    action.items.forEach((i) => {\n      copy.items[i.id] = i;\n    });\n    return assignItem(copy, \"SEARCH\", () => ({\n      children: action.items.map((i) => i.id),\n    }));\n  } else if (action.type === \"TOGGLE_SEARCH_VISIBILITY\") {\n    return {\n      ...state,\n      options: {\n        ...state.options,\n        isSearchVisible: !state.options.isSearchVisible,\n      },\n    };\n  } else if (action.type === \"START_DRAGGING_ITEM\") {\n    return {\n      ...state,\n      itemBeingDraggedId: action.itemId,\n    };\n  } else if (action.type === \"UPDATE_MOUSE_COORDINATES\") {\n    return {\n      ...state,\n      x: action.x,\n      y: action.y,\n    };\n  } else if (action.type === \"DROP_ITEM\") {\n    if (!state.itemBeingDraggedId || !state.dropDestinationPlaceholder)\n      return state;\n    const parentId = findParentId(state.items, state.itemBeingDraggedId || \"\");\n    const newState = assignItem(state, parentId, (i) => ({\n      children: i.children.filter(\n        (child) => child !== state.itemBeingDraggedId\n      ),\n    }));\n    return {\n      ...newState,\n      items: drop(\n        newState.items,\n        state.itemBeingDraggedId,\n        state.dropDestinationPlaceholder\n      ),\n      itemBeingDraggedId: undefined,\n      dropDestinationPlaceholder: undefined,\n    };\n  } else if (action.type === \"SET_DROP_POSITION\") {\n    return {\n      ...state,\n      dropDestinationPlaceholder: action.dropPosition,\n    };\n  }\n  return state;\n};\n\nexport const drop = (\n  items: NodesContainer,\n  itemBeingDragged: string,\n  dropDescription: DropDestinationPlaceholder\n): NodesContainer => {\n  if (dropDescription.dropDestination === \"inside\") {\n    let targetIndex = 0;\n\n    const newChildren = [...items[dropDescription.itemId].children];\n    newChildren.splice(targetIndex, 0, itemBeingDragged);\n    items[dropDescription.itemId] = {\n      ...items[dropDescription.itemId],\n      children: newChildren,\n    };\n  } else {\n    const nodeUnderParentId = findParentId(items, dropDescription.itemId);\n\n    let targetIndex = items[nodeUnderParentId].children.indexOf(\n      dropDescription.itemId\n    );\n\n    if (dropDescription.dropDestination === \"after\") {\n      targetIndex += 1;\n    }\n\n    const newChildren = [...items[nodeUnderParentId].children];\n    newChildren.splice(targetIndex, 0, itemBeingDragged);\n    items[nodeUnderParentId] = {\n      ...items[nodeUnderParentId],\n      children: newChildren,\n    };\n  }\n\n  return items;\n};\n","import React from \"react\";\nimport YouTube from \"react-youtube\";\nimport \"./Player.css\";\nexport const Player = ({ videoId }: { videoId: string }) => {\n  return (\n    <div className=\"player\">\n      <YouTube videoId={videoId} opts={playerOpts} />\n    </div>\n  );\n};\n\nconst playerOpts: any = {\n  height: 150,\n  width: 400,\n  playerVars: {\n    // https://developers.google.com/youtube/player_parameters\n    autoplay: 1,\n  },\n};\n","import { NodesContainer, RootState } from \"../types\";\n\nconst items: NodesContainer = {\n  HOME: {\n    children: [\"1\", \"2\"],\n    id: \"HOME\",\n    title: \"HOME\",\n  },\n\n  \"1\": { id: \"1\", title: \"First\", children: [\"3\"], videoId: \"XdsLeeQ4s_Q\" },\n  \"2\": { id: \"2\", title: \"Second\", children: [], videoId: \"L9pp1_en1EE\" },\n  \"3\": { id: \"3\", title: \"First sub\", children: [] },\n};\nexport const initialState: RootState = {\n  items,\n  videoIdBeingPlayed: undefined,\n  searchTerm: \"\",\n  options: {\n    isSearchVisible: true,\n  },\n  x: 0,\n  y: 0,\n  itemBeingDraggedId: undefined,\n};\n","import React from \"react\";\nimport { RootDispatch, UIOptions } from \"./types\";\nimport * as actions from \"./state/actions\";\n\ninterface Props {\n  options: UIOptions;\n  dispatch: RootDispatch;\n}\n\nconst Menu = React.memo(({ options, dispatch }: Props) => (\n  <div className=\"menu\" style={{ height: 50 }}>\n    search:\n    <button onClick={() => dispatch(actions.toggleSearchVisibility())}>\n      {options.isSearchVisible ? \"hide\" : \"show\"}\n    </button>\n  </div>\n));\n\nexport default Menu;\n","import { DropDestinationPlaceholder, Item } from \"../types\";\n\nexport const toggleIsItemOpen = (item: Item) =>\n  ({\n    itemId: item.id,\n    type: \"TOGGLE_ITEM\",\n  } as const);\n\nexport const removeItem = (item: Item) =>\n  ({\n    itemId: item.id,\n    type: \"REMOVE_ITEM\",\n  } as const);\n\nexport const renameItem = (itemId: string, newName: string) =>\n  ({\n    itemId,\n    newName,\n    type: \"RENAME_ITEM\",\n  } as const);\n\nexport const setSearchTerm = (term: string) =>\n  ({\n    term,\n    type: \"SET_SEARCH_TERM\",\n  } as const);\n\nexport const setNodeChildren = (nodeId: string, items: Item[]) =>\n  ({\n    items,\n    type: \"SET_NODE_CHILDREN\",\n  } as const);\n\nexport const playItem = (item: Item) =>\n  ({\n    item,\n    type: \"PLAY_ITEM\",\n  } as const);\n\nexport const toggleSearchVisibility = () =>\n  ({\n    type: \"TOGGLE_SEARCH_VISIBILITY\",\n  } as const);\n\nexport const startDraggingItem = (itemId: string) =>\n  ({\n    itemId,\n    type: \"START_DRAGGING_ITEM\",\n  } as const);\n\nexport const updateMouseCoordinatesDuringDrag = (x: number, y: number) =>\n  ({\n    x,\n    y,\n    type: \"UPDATE_MOUSE_COORDINATES\",\n  } as const);\n\nexport const dropItem = () =>\n  ({\n    type: \"DROP_ITEM\",\n  } as const);\n\nexport const setDropPosition = (dropPosition: DropDestinationPlaceholder) =>\n  ({\n    dropPosition,\n    type: \"SET_DROP_POSITION\",\n  } as const);\n\nexport const createNewNode = () =>\n  ({\n    node: {\n      children: [],\n      isOpen: false,\n      title: \"New Node\",\n      id: Math.random() + \"\",\n    } as Item,\n    parentId: \"HOME\",\n    type: \"APPEND_NODE\",\n  } as const);\n","import {Item, NodesContainer} from \"../types\";\r\n\r\nexport const traverseOpenNodes = (\r\n    items: NodesContainer,\r\n    rootKey: string,\r\n    mapper: (item: Item, level: number) => any\r\n) => {\r\n    const mapItem = (key: string, level: number): any => {\r\n        if (items[key].isOpen && items[key].children.length > 0)\r\n            return [\r\n                mapper(items[key], level),\r\n                ...items[key].children.map((i) => mapItem(i, level + 1)),\r\n            ];\r\n        else return mapper(items[key], level);\r\n    };\r\n    if (items[rootKey])\r\n        return items[rootKey].children\r\n            .map((i) => mapItem(i, 0))\r\n            .flat(Number.MAX_VALUE);\r\n};\r\n","import React from \"react\";\n\nexport const Triangle = (props: any) => {\n  const width = props.width || 10;\n\n  return (\n    <svg\n      height={width}\n      width={width}\n      viewBox={`0 0 ${width} ${width}`}\n      {...props}\n    >\n      <polygon\n        points={`\n        ${0},${0} \n        ${width},${width / 2} \n        ${0},${width}`}\n      />\n    </svg>\n  );\n};\n\n\n","import React, { useEffect, useState } from \"react\";\nimport { Item, RootAction } from \"./types\";\nimport * as actions from \"./state/actions\";\nimport \"./Row.css\";\nimport { Triangle } from \"./Triangle\";\n\nexport type DivMouseEvent = React.MouseEvent<HTMLDivElement, MouseEvent>;\nconst Row = React.memo(\n  ({ item, level, dispatch, listenToDragEvents }: Props) => {\n    const [isBeingEdited, setIsBeingEdited] = React.useState(false);\n    const distanceTraveled = React.useRef(0);\n    const inputRef = React.useRef<HTMLInputElement>(null);\n\n    useEffect(() => {\n      if (isBeingEdited && inputRef.current) {\n        inputRef.current.focus();\n      }\n    }, [isBeingEdited]);\n\n    const [isMouseDown, setIsMouseDown] = useState(false);\n\n    const onMouseMove = React.useCallback(\n      (e: MouseEvent) => {\n        if (distanceTraveled.current > 5) {\n          dispatch(actions.startDraggingItem(item.id));\n          dispatch(\n            actions.updateMouseCoordinatesDuringDrag(e.clientX, e.clientY)\n          );\n          console.log(\"Staring to drag\");\n        } else {\n          distanceTraveled.current += Math.sqrt(\n            e.movementY * e.movementY + e.movementX * e.movementX\n          );\n        }\n      },\n      [dispatch, item]\n    );\n    const onMouseUp = React.useCallback(() => {\n      distanceTraveled.current = 0;\n      dispatch(actions.dropItem());\n      setIsMouseDown(false);\n    }, [dispatch]);\n\n    const onMouseOverDuringDrag = (e: DivMouseEvent) => {\n      const rect = e.currentTarget.getBoundingClientRect();\n      const x = e.clientX - rect.x;\n      const y = e.clientY - rect.y;\n      dispatch(\n        actions.setDropPosition({\n          rect: e.currentTarget.getBoundingClientRect(),\n          dropDestination:\n            y > 20 ? (x > 60 + level * 20 ? \"inside\" : \"after\") : \"before\",\n          targetLevel: level,\n          itemId: item.id,\n        })\n      );\n    };\n\n    useEffect(() => {\n      if (isMouseDown) {\n        document.addEventListener(\"mousemove\", onMouseMove);\n        document.addEventListener(\"mouseup\", onMouseUp);\n      } else {\n        document.removeEventListener(\"mouseup\", onMouseUp);\n        document.removeEventListener(\"mousemove\", onMouseMove);\n      }\n      return () => {\n        document.removeEventListener(\"mouseup\", onMouseUp);\n        document.removeEventListener(\"mousemove\", onMouseMove);\n      };\n    }, [isMouseDown, onMouseUp, onMouseMove]);\n    return (\n      <div\n        className=\"row\"\n        key={item.id}\n        style={{ paddingLeft: level * 20 }}\n        onMouseMove={listenToDragEvents ? onMouseOverDuringDrag : undefined}\n      >\n        <div\n          className=\"small-text red\"\n          onClick={() => dispatch(actions.removeItem(item))}\n        >\n          X\n        </div>\n        <div className=\"small-text\" onClick={() => setIsBeingEdited(true)}>\n          E\n        </div>\n        <Triangle\n          className={\n            \"triangle \" +\n            (item.children.length === 0 ? \"transparent \" : \"\") +\n            (item.isOpen ? \"open \" : \"\")\n          }\n          data-testid={\"triangle-\" + item.id}\n          onClick={() => dispatch(actions.toggleIsItemOpen(item))}\n        />\n        <div className=\"circle\" onMouseDown={() => setIsMouseDown(true)}>\n          {item.videoId && (\n            <>\n              <img\n                src={`https://i.ytimg.com/vi/${item.videoId}/mqdefault.jpg`}\n                alt=\"1\"\n              />\n              <div className=\"playButtonContainer\">\n                <Triangle\n                  onClick={() => dispatch(actions.playItem(item))}\n                  className={\"playButton\"}\n                  width={14}\n                />\n              </div>\n            </>\n          )}\n        </div>\n        {isBeingEdited ? (\n          <input\n            type=\"text\"\n            value={item.title}\n            ref={inputRef}\n            onBlur={() => setIsBeingEdited(false)}\n            onChange={(e) =>\n              dispatch(actions.renameItem(item.id, e.currentTarget.value))\n            }\n          />\n        ) : (\n          <span className=\"text\">{item.title}</span>\n        )}\n      </div>\n    );\n  }\n);\n\ninterface Props {\n  item: Item;\n  level: number;\n  listenToDragEvents: boolean;\n  dispatch: (action: RootAction) => void;\n}\n\nexport default Row;\n","import { Item, NodesContainer, RootDispatch } from \"./types\";\nimport { traverseOpenNodes } from \"./state/selectors\";\nimport Row from \"./Row\";\nimport React from \"react\";\n\ninterface Props {\n  items: NodesContainer;\n  rootName: string;\n  listenToDragEvents: boolean;\n  dispatch: RootDispatch;\n}\n\nexport const ItemsTree = ({\n  items,\n  rootName,\n  listenToDragEvents,\n  dispatch,\n}: Props) => {\n  const renderRow = (item: Item, level: number) => (\n    <Row\n      key={item.id}\n      listenToDragEvents={listenToDragEvents}\n      item={item}\n      level={level}\n      dispatch={dispatch}\n    />\n  );\n  return <>{traverseOpenNodes(items, rootName, renderRow)}</>;\n};\n","import React, {useEffect} from \"react\";\nimport {debounce} from \"lodash\";\nimport {searchItems} from \"./api\";\nimport * as actions from \"./state/actions\";\nimport {RootDispatch, RootState} from \"./types\";\nimport {ItemsTree} from \"./ItemsTree\";\n\ninterface Props {\n  state: RootState;\n  dispatch: RootDispatch;\n}\n\nexport const SearchPanel = ({ state, dispatch }: Props) => {\n  const search = React.useCallback(\n    debounce(\n      (searchTerm: string) =>\n        searchItems(searchTerm).then((items) =>\n          dispatch(actions.setNodeChildren(\"SEARCH\", items))\n        ),\n      600,\n      { trailing: true }\n    ),\n    []\n  );\n\n\n  useEffect(() => {\n    if (state.searchTerm) search(state.searchTerm);\n  }, [state.searchTerm, search]);\n\n  if (!state.options.isSearchVisible) return null;\n\n  return (\n    <div>\n      <h5>Search</h5>\n      <input\n        type=\"text\"\n        value={state.searchTerm}\n        onChange={(e) => dispatch(actions.setSearchTerm(e.currentTarget.value))}\n      />\n      <ItemsTree listenToDragEvents={!!state.itemBeingDraggedId} items={state.items} dispatch={dispatch} rootName=\"SEARCH\" />\n    </div>\n  );\n};\n","import { Item } from \"./types\";\n\nexport const searchItems = (searchTerm: string): Promise<Item[]> => {\n  const url =\n    \"https://europe-west1-lean-watch.cloudfunctions.net/getVideos?q=\" +\n    searchTerm;\n  return fetch(url)\n    .then((response) => response.json())\n    .then((data: any) =>\n      data.items.map((i: any) => ({\n        id: i.id,\n        title: i.name,\n        children: [],\n        isOpen: false,\n        videoId: i.itemId,\n      }))\n    );\n};\n","import React from \"react\";\n\ninterface Props {\n  x: number;\n  y: number;\n  text: string;\n  videoId: string;\n}\n\nexport const ItemBeingDraggedAvatar = ({ x, y, text, videoId }: Props) => {\n  return (\n    <div\n      style={{\n        position: \"fixed\",\n        top: y - 15,\n        left: x - 15,\n        pointerEvents: \"none\",\n        display: \"flex\",\n        alignItems: \"center\",\n      }}\n    >\n      <div\n        style={{\n          backgroundColor: \"lightblue\",\n          width: 30,\n          height: 30,\n          borderRadius: 30,\n        }}\n      >\n        {videoId && (\n          <img\n            style={{ width: 30, height: 30, borderRadius: 30 }}\n            src={`https://i.ytimg.com/vi/${videoId}/mqdefault.jpg`}\n            alt=\"1\"\n          />\n        )}\n      </div>\n      <span style={{ fontSize: 12, marginLeft: 5, width: 300 }}>{text}</span>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { DropDestinationPlaceholder } from \"./types\";\n\ninterface Props {\n  dropDestinationPlaceholder?: DropDestinationPlaceholder;\n}\n\nexport const DropDestinationLine = ({ dropDestinationPlaceholder }: Props) => {\n  if (!dropDestinationPlaceholder) return null;\n\n  return (\n    <div\n      style={{\n        position: \"absolute\",\n        top:\n          dropDestinationPlaceholder.rect.top -\n          5 +\n          (dropDestinationPlaceholder.dropDestination === \"before\" ? 0 : 50),\n        left:\n          40 +\n          dropDestinationPlaceholder.rect.left +\n          dropDestinationPlaceholder.targetLevel * 20 +\n          (dropDestinationPlaceholder.dropDestination === \"inside\" ? 20 : 0),\n        height: 2,\n        backgroundColor: \"lightblue\",\n        width:\n          dropDestinationPlaceholder.rect.width -\n          40 -\n          dropDestinationPlaceholder.targetLevel * 20 -\n          (dropDestinationPlaceholder.dropDestination === \"inside\" ? 20 : 0),\n      }}\n    />\n  );\n};\n","import React from \"react\";\nimport \"./App.css\";\nimport { reducer } from \"./state/reducer\";\nimport * as actions from \"./state/actions\";\nimport { Player } from \"./Player\";\nimport { initialState } from \"./state/initialState\";\nimport Menu from \"./Menu\";\nimport { SearchPanel } from \"./SearchPanel\";\nimport { ItemsTree } from \"./ItemsTree\";\nimport { ItemBeingDraggedAvatar } from \"./ItemBeingDraggedAvatar\";\n// @ts-ignore\nimport cn from \"classnames\";\nimport { DropDestinationLine } from \"./DropDestinationIndicator\";\n\nconst App = () => {\n  const [state, dispatch] = React.useReducer(reducer, initialState);\n\n  return (\n    <div\n      className={cn({\n        \"page-container\": true,\n        \"page-during-drag\": state.itemBeingDraggedId,\n      })}\n    >\n      <Menu options={state.options} dispatch={dispatch} />\n      <div className=\"page\">\n        <div>\n          <ItemsTree\n            listenToDragEvents={!!state.itemBeingDraggedId}\n            items={state.items}\n            dispatch={dispatch}\n            rootName=\"HOME\"\n          />\n          <button onClick={() => dispatch(actions.createNewNode())}>add</button>\n        </div>\n        <SearchPanel state={state} dispatch={dispatch} />\n      </div>\n      {state.videoIdBeingPlayed && (\n        <Player videoId={state.videoIdBeingPlayed} />\n      )}\n      {state.itemBeingDraggedId && (\n        <ItemBeingDraggedAvatar\n          x={state.x}\n          y={state.y}\n          text={state.items[state.itemBeingDraggedId].title}\n          videoId={state.items[state.itemBeingDraggedId].videoId || \"\"}\n        />\n      )}\n      <DropDestinationLine\n        dropDestinationPlaceholder={state.dropDestinationPlaceholder}\n      />\n    </div>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './app/App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}